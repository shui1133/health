<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘¼å¸æ²»ç™‚è¨ºæ‰€ - FAQ ç®¡ç†å¾Œå°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <nav class="gradient-bg text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center">
                <span class="mr-2">ğŸ¥</span> å°ˆæ¥­å‘¼å¸æ²»ç™‚è¨ºæ‰€ç®¡ç†ç³»çµ±
            </h1>
            <div class="space-x-4">
                <button onclick="switchTab('faq')" class="hover:underline">FAQ ç®¡ç†</button>
                <button onclick="switchTab('class')" class="hover:underline">åˆ†é¡ç®¡ç†</button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4 mt-6">
        <!-- åˆ†é¡ç®¡ç†å€å¡Š -->
        <section id="class-section" class="hidden">
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-2xl font-semibold mb-4 text-blue-800">åˆ†é¡æ¬„ä½ç®¡ç†</h2>
                <div class="flex gap-2 mb-6">
                    <input id="new-class" type="text" placeholder="è¼¸å…¥æ–°åˆ†é¡åç¨±" class="border rounded px-4 py-2 w-full">
                    <button onclick="addClass()" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">æ–°å¢</button>
                </div>
                <div id="class-list" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <!-- åˆ†é¡æ¨™ç±¤æœƒåœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </section>

        <!-- FAQ ç®¡ç†å€å¡Š -->
        <section id="faq-section">
            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <div class="flex flex-wrap justify-between items-center mb-6 gap-4">
                    <h2 class="text-2xl font-semibold text-blue-800">FAQ è³‡æ–™ç¶­è­·</h2>
                    <div class="flex gap-2">
                        <input type="file" id="csv-upload" accept=".csv" class="hidden" onchange="handleCSVUpload(event)">
                        <button onclick="document.getElementById('csv-upload').click()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">åŒ¯å…¥ CSV</button>
                        <button onclick="exportData()" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">å„²å­˜ä¸¦ä¸‹è¼‰ CSV</button>
                    </div>
                </div>

                <!-- æ‰‹å·¥è¼¸å…¥è¡¨å–® -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 border rounded-lg bg-blue-50">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">åˆ†é¡</label>
                        <select id="faq-category" class="w-full border rounded p-2"></select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700">å•é¡Œèªªæ˜</label>
                        <input id="faq-question" type="text" class="w-full border rounded p-2">
                    </div>
                    <div class="md:col-span-3">
                        <label class="block text-sm font-medium text-gray-700">ç­”æ¡ˆå…§å®¹ (300-500å­—)</label>
                        <textarea id="faq-answer" rows="4" class="w-full border rounded p-2"></textarea>
                    </div>
                    <div class="md:col-span-3 flex justify-end">
                        <button id="save-btn" onclick="addFAQ()" class="bg-blue-800 text-white px-8 py-2 rounded hover:bg-blue-900 transition">æ–°å¢ FAQ</button>
                    </div>
                </div>

                <!-- FAQ åˆ—è¡¨ -->
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-100 border-b">
                                <th class="p-3 text-sm font-semibold text-gray-600">é …æ¬¡</th>
                                <th class="p-3 text-sm font-semibold text-gray-600">åˆ†é¡</th>
                                <th class="p-3 text-sm font-semibold text-gray-600">å•é¡Œ</th>
                                <th class="p-3 text-sm font-semibold text-gray-600">ç­”æ¡ˆæ‘˜è¦</th>
                                <th class="p-3 text-sm font-semibold text-gray-600">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="faq-table-body">
                            <!-- è³‡æ–™è¡Œå°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>

    <script>
        let faqs = JSON.parse(localStorage.getItem('faqs')) || [];
        let categories = JSON.parse(localStorage.getItem('categories')) || ["è£œåŠ©æ”¿ç­–", "è¨­å‚™ä½¿ç”¨", "å‘¼å¸ç…§è­·", "é–€è¨ºè³‡è¨Š"];
        let editIndex = -1;

        function renderAll() {
            renderCategories();
            renderFAQs();
        }

        function switchTab(tab) {
            document.getElementById('faq-section').classList.toggle('hidden', tab !== 'faq');
            document.getElementById('class-section').classList.toggle('hidden', tab !== 'class');
        }

        // åˆ†é¡ç®¡ç†é‚è¼¯
        function renderCategories() {
            const list = document.getElementById('class-list');
            const select = document.getElementById('faq-category');
            list.innerHTML = '';
            select.innerHTML = '';
            categories.forEach((cat, index) => {
                list.innerHTML += `
                    <div class="flex justify-between items-center bg-gray-100 p-2 rounded">
                        <span>${cat}</span>
                        <button onclick="deleteCategory(${index})" class="text-red-500 hover:text-red-700">âœ•</button>
                    </div>`;
                select.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
            localStorage.setItem('categories', JSON.stringify(categories));
        }

        function addClass() {
            const input = document.getElementById('new-class');
            if (input.value.trim()) {
                categories.push(input.value.trim());
                input.value = '';
                renderCategories();
            }
        }

        function deleteCategory(index) {
            categories.splice(index, 1);
            renderCategories();
        }

        // FAQ ç®¡ç†é‚è¼¯
        function renderFAQs() {
            const tbody = document.getElementById('faq-table-body');
            tbody.innerHTML = '';
            faqs.forEach((item, index) => {
                tbody.innerHTML += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-3">${index + 1}</td>
                        <td class="p-3"><span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">${item.category}</span></td>
                        <td class="p-3 font-medium">${item.question}</td>
                        <td class="p-3 text-gray-500 truncate max-w-xs">${item.answer.substring(0, 30)}...</td>
                        <td class="p-3 space-x-2">
                            <button onclick="editFAQ(${index})" class="text-blue-600 hover:underline">ä¿®æ”¹</button>
                            <button onclick="deleteFAQ(${index})" class="text-red-600 hover:underline">åˆªé™¤</button>
                        </td>
                    </tr>`;
            });
            localStorage.setItem('faqs', JSON.stringify(faqs));
        }

        function addFAQ() {
            const category = document.getElementById('faq-category').value;
            const question = document.getElementById('faq-question').value;
            const answer = document.getElementById('faq-answer').value;

            if (!question || !answer) {
                alert("è«‹å®Œæ•´å¡«å¯«å•é¡Œèˆ‡ç­”æ¡ˆå…§å®¹");
                return;
            }

            if (editIndex > -1) {
                faqs[editIndex] = { category, question, answer };
                editIndex = -1;
                document.getElementById('save-btn').innerText = "æ–°å¢ FAQ";
            } else {
                faqs.push({ category, question, answer });
            }

            document.getElementById('faq-question').value = '';
            document.getElementById('faq-answer').value = '';
            renderFAQs();
        }

        function editFAQ(index) {
            editIndex = index;
            const item = faqs[index];
            document.getElementById('faq-category').value = item.category;
            document.getElementById('faq-question').value = item.question;
            document.getElementById('faq-answer').value = item.answer;
            document.getElementById('save-btn').innerText = "æ›´æ–° FAQ";
            window.scrollTo(0, 0);
        }

        function deleteFAQ(index) {
            if (confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è³‡æ–™å—ï¼Ÿ")) {
                faqs.splice(index, 1);
                renderFAQs();
            }
        }

        // CSV è™•ç†
        function handleCSVUpload(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const rows = text.split('\n').slice(1);
                rows.forEach(row => {
                    const cols = row.split(',');
                    if (cols.length >= 3) {
                        faqs.push({
                            category: cols[1].trim(),
                            question: cols[2].trim(),
                            answer: cols[3] ? cols[3].trim() : ""
                        });
                    }
                });
                renderFAQs();
                alert("åŒ¯å…¥æˆåŠŸï¼");
            };
            reader.readAsText(file);
        }

        function exportData() {
            // ä¸‹è¼‰ FAQ.csv
            let faqCSV = "é …æ¬¡,åˆ†é¡,å•é¡Œ,ç­”æ¡ˆ\n" + faqs.map((f, i) => `${i+1},${f.category},${f.question},"${f.answer.replace(/"/g, '""')}"`).join('\n');
            downloadCSV(faqCSV, 'FAQ.csv');

            // ä¸‹è¼‰ class.csv
            let classCSV = "åˆ†é¡åç¨±\n" + categories.join('\n');
            downloadCSV(classCSV, 'class.csv');
            
            alert("è³‡æ–™å·²å„²å­˜ä¸¦ç”¢ç”Ÿä¸‹è¼‰æª”æ¡ˆ (FAQ.csv, class.csv)");
        }

        function downloadCSV(csvContent, fileName) {
            const encodedUri = encodeURI("data:text/csv;charset=utf-8,\uFEFF" + csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", fileName);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        window.onload = renderAll;
    </script>
</body>
</html>